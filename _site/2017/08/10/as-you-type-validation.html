<!doctype html>
<html>
  <head>
	<meta charset="utf-8">
<meta name="description" content="Portfolio Site for Matt Peebles">
<meta name="author" content="Matt Peebles">
<meta name="viewport" content="width=device-width, height=device-height">
<title>Matt Peebles</title>
<link rel="shortcut icon" href="./resources/images/hero-image.png" type="image/x-icon">
<link rel="stylesheet" type="text/css" href="/main.css">
    <title>As You Type Validation</title>
  </head>
  <body>
    <nav id="nav">
    <div>
        Matt Peebles
    </div>
    <div id="sections">
        
        <a href="/resume.html" >
          Resume
        </a>
      
        <a href="/essays.html" >
          Essays
        </a>
      
        <a href="art.html" >
          Art
        </a>
      
    </div>
</nav>
    <h1>As You Type Validation</h1>
<p>10 Aug 2017 - matt</p>

<p>I’ve recently completed a project that required users to create an account in order to use the service. The account uses their email address as a username, so each user must submit a unique email upon
account creation otherwise things will get confusing. I wasn’t using a front-end framework, so my solution needed to
be pure javascript/jquery.</p>

<p>I wanted to make the experience seamless for my user so that they didn’t have to
submit the form to see if an email was taken. But in order to check my database for a duplicate email, I had to
submit an ajax call to my database each time the user typed.</p>

<p>So my goal was fairly straightforward. Every
time the user typed in an email, I wanted the user to receive instant feedback on whether or not the email had
already been used to create an account.</p>

<p>Luckily there is a jQuery plugin, <a href="https://jqueryvalidation.org/documentation">jQuery Validator</a> that will allow you to validate a form as the user types. The plugin validates according to rules you set on the form. So let’s take a simple html form
that asks for an email:</p>

<p><code class="language-plaintext highlighter-rouge">index.html</code></p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">"emailForm"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label&gt;</span>Email<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"email"</span> <span class="na">id=</span><span class="s">"email"</span> <span class="nt">/&gt;</span> 
<span class="nt">&lt;/form&gt;</span>;`
</code></pre></div></div>

<p>And then in your javascript file, we use jquery to hook onto the top level of the form</p>

<p><code class="language-plaintext highlighter-rouge">app.js</code></p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">validate</span><span class="p">(){</span>   
     <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#emailForm</span><span class="dl">'</span><span class="p">).</span><span class="nf">validate</span><span class="p">({})</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Within the validate function we can see that it takes an object. We’ll be using the  <a href="https://jqueryvalidation.org/validate/#rules\">rules</a> and <a href="https://jqueryvalidation.org/validate/#success\">success</a> methods today. But  <a href="https://jqueryvalidation.org/validate/#normalizer\">normalizer</a> is also extremely powerful as it allows you to write functions that change the value before it is validator. It is more or less like middleware for the validator itself.</p>

<p>Validator takes an object and where one of its keys are rules. Rules also takes an
    object where each of the keys is the <em>name</em> of the element that you’d like to validate.</p>

<p><code class="language-plaintext highlighter-rouge">app.js</code></p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">validate</span><span class="p">(){</span>    
    <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#emailForm</span><span class="dl">'</span><span class="p">).</span><span class="nf">validate</span><span class="p">({</span>            
        <span class="na">rules</span><span class="p">:</span> <span class="p">{</span>                
            <span class="na">email</span><span class="p">:</span> <span class="p">{</span>                    
                <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>                    
                <span class="na">email</span><span class="p">:</span> <span class="kc">true</span>                
            <span class="p">}</span>        
        <span class="p">}</span>    
    <span class="p">})</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The required key will ensure that there is a value in the input before it is submit. Likewise, email ensures that the value conforms to the standard email format. Normalizer, mentioned before, is also a key that can be placed within the named rules.</p>

<p>Now, our form is actively validated as the user types. However, currently, this only ensures that the user types in a email, so duplicates are still possible.</p>

<p>jQuery also comes with a method that allows you to call functions once a value is successfully validated. This <strong>success</strong> method calls the function everytime an input is validated, not once the entire form is validated. It takes label as an argument.</p>

<p>This allows us to query our database once the user has entered an email into the email input. We’ll use an ajax call to query our database. I’ve quickly set up an API hook that allows us to post an email to it which it uses to query the database for that email, counts the number of matching documents and returns a message with the result. If the count is greater than 0 than we have a duplicate email and it tells us so.</p>

<p>For my project I’ve used node and express for my backend with a mongodb database.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/email</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>    
    <span class="kd">let</span> <span class="p">{</span><span class="nx">email</span><span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span>  <span class="c1">//the email the user has inputted    </span>
    
    <span class="c1">//returns a promise with the number of emails that match, that's passed to then as count   </span>
    <span class="k">return</span> <span class="nx">Users</span>
            <span class="p">.</span><span class="nf">find</span><span class="p">({</span><span class="nx">email</span><span class="p">})</span>
            <span class="p">.</span><span class="nf">count</span><span class="p">()</span>
            <span class="p">.</span><span class="nf">exec</span><span class="p">()</span>     
            <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="nx">count</span> <span class="o">=&gt;</span> <span class="p">{</span>            
                <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">Email has already been used to create an account</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">Valid email</span><span class="dl">'</span><span class="p">;</span>
                <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">json</span><span class="p">({</span><span class="nx">message</span><span class="p">})</span>       
            <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div>

<p>Now that we’ve got an api hook, we can use it within our success method in jquery validator. Success takes a label as an argument. If you <code class="language-plaintext highlighter-rouge">console.log(label)</code> you return an object. If you have a form with multiple variables, you obviously only want to make the ajax call with an email. The label object has a key called <code class="language-plaintext highlighter-rouge">htmlFor</code> that returns the name of the input that the success function is being called on. It’s easy to set a conditional that checks for that to be true before posting the ajax call.</p>

<p><code class="language-plaintext highlighter-rouge">app.js</code></p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">validate</span><span class="p">(){</span>    
    <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#emailForm</span><span class="dl">'</span><span class="p">).</span><span class="nf">validate</span><span class="p">({</span>        
        <span class="na">rules</span><span class="p">:</span> <span class="p">{</span>            
            <span class="na">email</span><span class="p">:</span> <span class="p">{</span>                
                <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>                
                <span class="na">email</span><span class="p">:</span> <span class="kc">true</span>            
            <span class="p">}</span>        
        <span class="p">},</span>        
        <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">label</span><span class="p">){</span>            
            <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span><span class="p">{</span><span class="na">email</span><span class="p">:</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#email</span><span class="dl">'</span><span class="p">).</span><span class="nf">val</span><span class="p">()</span> <span class="p">}</span> <span class="c1">//now that we know it's a valid email we can use jquery to grab the value           </span>
            <span class="nx">$</span><span class="p">.</span><span class="nf">ajax</span><span class="p">({</span>                
                <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">post</span><span class="dl">'</span><span class="p">,</span>                
                <span class="na">url</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/email</span><span class="dl">'</span><span class="p">,</span>                
                <span class="na">data</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span>                
                <span class="na">contentType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>                
                <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>                        
                    <span class="k">if </span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">Email has already been used to create an account</span><span class="dl">'</span><span class="p">){</span>                               
                        <span class="kd">let</span> <span class="nx">parent</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#email</span><span class="dl">'</span><span class="p">).</span><span class="nf">parent</span><span class="p">()</span>                                
                        <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#email</span><span class="dl">'</span><span class="p">).</span><span class="nf">removeClass</span><span class="p">(</span><span class="dl">'</span><span class="s1">valid</span><span class="dl">'</span><span class="p">).</span><span class="nf">addClass</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">)</span>                                
                        <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#email-error</span><span class="dl">'</span><span class="p">).</span><span class="nf">text</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span>                        
                    <span class="p">}</span>                    
                <span class="p">}</span>            
            <span class="p">})</span>        
        <span class="p">}</span>    
    <span class="p">})</span>
<span class="p">}</span>
</code></pre></div></div>

<p>So within our ajax call, we’ve send a JSON object with the user email. Our api hook has returned a JSON object to the client side that has a message as a key. Calling data.message within the success method of the ajax call with let us read the message. If the message tells us that the email has already been taken, then we need to <em>overwrite</em> the validator added classes on #email and #email-error. #email-error is an element that is appended to #email once it has an error class. Editing the text of the error message will inform our user of the problem.</p>

<p>We can also use some basic CSS to visualize the state of the input.</p>

<p><code class="language-plaintext highlighter-rouge">main.css</code></p>
<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">input</span><span class="nc">.error</span>
<span class="p">{</span>    
    <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="no">red</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">input</span><span class="nc">.error</span><span class="nd">:focus</span>
<span class="p">{</span>    
    <span class="nl">border</span><span class="p">:</span><span class="m">1px</span> <span class="nb">solid</span> <span class="no">red</span><span class="p">;</span>    
    <span class="nl">box-shadow</span><span class="p">:</span> <span class="m">0</span> <span class="m">0</span> <span class="m">5px</span> <span class="no">red</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">input</span><span class="nc">.valid</span>
<span class="p">{</span>    
    <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="no">green</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">input</span><span class="nc">.valid</span><span class="nd">:focus</span>
<span class="p">{</span>   
    <span class="nl">border</span><span class="p">:</span><span class="m">1px</span> <span class="nb">solid</span> <span class="no">green</span><span class="p">;</span>    
    <span class="nl">box-shadow</span><span class="p">:</span> <span class="m">0</span> <span class="m">0</span> <span class="m">5px</span> <span class="no">green</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now every time the user inputs an appropriate email, they will receive instant feedback about whether it is a valid email and can adjust their input accordingly.</p>

    <social>
    <div>
        <a href="https://linkedin.com/in/mmpeebles" target="_blank" rel="noopener noreferrer">LinkedIn</a>
    </div>
    <div>
        <a href='https://github.com/mattpeebles' target="_blank" rel="noopener noreferrer">Github</a>
    </div>
</social>
  </body>
</html>